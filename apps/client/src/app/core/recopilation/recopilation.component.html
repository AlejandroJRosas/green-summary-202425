<main class="flex flex-column p-4">
  <header class="flex flex-row justify-content-between align-items-center pb-4">
    <h2>Recopilaciones</h2>
    <div
      class="flex flex-row flex-wrap gap-2"
      [style]="{
        'margin-right': 'auto',
        'margin-left': '1rem'
      }"
    >
      <p-button
        (click)="expandAll()"
        label="Expandir"
        icon="pi pi-chevron-down"
        [rounded]="true"
        severity="info"
        [outlined]="true"
        tooltipPosition="left"
        [style]="{
          padding: '10px'
        }"
      />
      <p-button
        (click)="collapseAll()"
        label="Colapsar"
        icon="pi pi-chevron-right"
        [rounded]="true"
        severity="info"
        [outlined]="true"
        tooltipPosition="left"
        [style]="{
          padding: '10px'
        }"
      />
    </div>
    <p-button
      (click)="navigateStepsCreate()"
      styleClass="bg-primary border-primary mr-4"
      label="Crear"
      icon="pi pi-plus"
      size="small"
    />
  </header>
  <section class="flex flex-column">
    @if (inCreationRecopilations.length > 0) {
      <p-panel
        expandIcon="pi pi-chevron-down"
        collapseIcon="pi pi-chevron-right"
        [toggleable]="true"
        collapsed="false"
        iconPos="start"
        (collapsedChange)="changed()"
      >
        <ng-template pTemplate="header">
          <h3 class="text-xl">
            <i
              class="pi pi-circle-fill"
              style="color: var(--severity-info)"
            ></i>
            En Creación ({{ inCreationRecopilations.length }})
          </h3>
        </ng-template>
        @for (recopilation of inCreationRecopilations; track recopilation.id) {
          <p-panel>
            <ng-template pTemplate="header">
              <section
                class="flex flex-row justify-content-between align-items-center w-full gap-4"
              >
                <h2 style="word-break: break-word" class="text-xl">
                  {{ recopilation.name }}
                  (Por completar)
                </h2>

                <div class="flex flex-row gap-3">
                  @if (!recopilation.isReady) {
                    <p-button
                      severity="info"
                      icon="pi pi-play"
                      rounded="true"
                      outlined="true"
                      pTooltip="Continuar"
                      tooltipPosition="left"
                      (click)="navigateContinueSteps(recopilation.id)"
                    />
                  } @else {
                    <p-button
                      severity="success"
                      icon="pi pi-eye"
                      rounded="true"
                      outlined="true"
                      pTooltip="Ver Detalles"
                      tooltipPosition="left"
                      (click)="navigateRecopilationDetails(recopilation.id)"
                    />
                  }
                  <p-button
                    severity="warning"
                    icon="pi pi-trash"
                    rounded="true"
                    outlined="true"
                    pTooltip="Eliminar"
                    tooltipPosition="left"
                    (click)="
                      confirmRecopilationDeletion(
                        $event,
                        recopilation.id,
                        recopilation.name
                      )
                    "
                  />
                </div>
              </section>
            </ng-template>
            <p class="m-0 pb-3" style="max-width: 80vw">
              {{ recopilation.description }}
            </p>
          </p-panel>
        }
      </p-panel>
    }

    @if (activeRecopilations.length > 0) {
      <p-panel
        expandIcon="pi pi-chevron-down"
        collapseIcon="pi pi-chevron-right"
        [toggleable]="true"
        collapsed="false"
        iconPos="start"
        (collapsedChange)="changed()"
      >
        <ng-template pTemplate="header">
          <h3 class="text-xl">
            <i
              class="pi pi-circle-fill"
              style="color: var(--severity-success)"
            ></i>
            Activas ({{ activeRecopilations.length }})
          </h3>
        </ng-template>
        @for (recopilation of activeRecopilations; track recopilation.id) {
          <p-panel>
            <ng-template pTemplate="header">
              <section
                class="flex flex-row justify-content-between align-items-center w-full gap-4"
              >
                <h2 style="word-break: break-word" class="text-xl">
                  {{ recopilation.name }} | {{ recopilation.startDate }} -
                  {{ recopilation.endDate }} |
                </h2>

                <div class="flex flex-row gap-3">
                  @if (!recopilation.isReady) {
                    <p-button
                      severity="info"
                      icon="pi pi-play"
                      rounded="true"
                      outlined="true"
                      pTooltip="Continuar"
                      tooltipPosition="left"
                      (click)="navigateContinueSteps(recopilation.id)"
                    />
                  } @else {
                    <p-button
                      severity="success"
                      icon="pi pi-eye"
                      rounded="true"
                      outlined="true"
                      pTooltip="Ver Detalles"
                      tooltipPosition="left"
                      (click)="navigateRecopilationDetails(recopilation.id)"
                    />
                  }
                  <p-button
                    severity="warning"
                    icon="pi pi-trash"
                    rounded="true"
                    outlined="true"
                    pTooltip="Eliminar"
                    tooltipPosition="left"
                    (click)="
                      confirmRecopilationDeletion(
                        $event,
                        recopilation.id,
                        recopilation.name
                      )
                    "
                  />
                </div>
              </section>
            </ng-template>
            <p class="m-0 pb-3" style="max-width: 80vw">
              {{ recopilation.description }}
            </p>
          </p-panel>
        }
      </p-panel>
    }

    @if (upcomingRecopilations.length > 0) {
      <p-panel
        expandIcon="pi pi-chevron-down"
        collapseIcon="pi pi-chevron-right"
        [toggleable]="true"
        collapsed="false"
        iconPos="start"
        (collapsedChange)="changed()"
      >
        <ng-template pTemplate="header">
          <h3 class="text-xl">
            <i
              class="pi pi-circle-fill"
              style="color: var(--ucab-yellow-hex)"
            ></i>
            Próximas ({{ upcomingRecopilations.length }})
          </h3>
        </ng-template>
        @for (recopilation of upcomingRecopilations; track recopilation.id) {
          <p-panel>
            <ng-template pTemplate="header">
              <section
                class="flex flex-row justify-content-between align-items-center w-full gap-4"
              >
                <h2 style="word-break: break-word" class="text-xl">
                  {{ recopilation.name }} | {{ recopilation.startDate }} -
                  {{ recopilation.endDate }} |
                </h2>

                <div class="flex flex-row gap-3">
                  @if (!recopilation.isReady) {
                    <p-button
                      severity="info"
                      icon="pi pi-play"
                      rounded="true"
                      outlined="true"
                      pTooltip="Continuar"
                      tooltipPosition="left"
                      (click)="navigateContinueSteps(recopilation.id)"
                    />
                  } @else {
                    <p-button
                      severity="success"
                      icon="pi pi-eye"
                      rounded="true"
                      outlined="true"
                      pTooltip="Ver Detalles"
                      tooltipPosition="left"
                      (click)="navigateRecopilationDetails(recopilation.id)"
                    />
                  }
                  <p-button
                    severity="warning"
                    icon="pi pi-trash"
                    rounded="true"
                    outlined="true"
                    pTooltip="Eliminar"
                    tooltipPosition="left"
                    (click)="
                      confirmRecopilationDeletion(
                        $event,
                        recopilation.id,
                        recopilation.name
                      )
                    "
                  />
                </div>
              </section>
            </ng-template>
            <p class="m-0 pb-3" style="max-width: 80vw">
              {{ recopilation.description }}
            </p>
          </p-panel>
        }
      </p-panel>
    }

    @if (finishedRecopilations.length > 0) {
      <p-panel
        expandIcon="pi pi-chevron-down"
        collapseIcon="pi pi-chevron-right"
        [toggleable]="true"
        collapsed="true"
        iconPos="start"
        (collapsedChange)="changed()"
      >
        <ng-template pTemplate="header">
          <h3 class="text-xl">
            <i class="pi pi-circle-fill" style="color: gray"></i> Finalizadas
            ({{ finishedRecopilations.length }})
          </h3>
        </ng-template>
        @for (recopilation of finishedRecopilations; track recopilation.id) {
          <p-panel>
            <ng-template pTemplate="header">
              <section
                class="flex flex-row justify-content-between align-items-center w-full gap-4"
              >
                <h2 style="word-break: break-word" class="text-xl">
                  {{ recopilation.name }} | {{ recopilation.startDate }} -
                  {{ recopilation.endDate }} |
                </h2>

                <div class="flex flex-row gap-3">
                  @if (!recopilation.isReady) {
                    <p-button
                      severity="info"
                      icon="pi pi-play"
                      rounded="true"
                      outlined="true"
                      pTooltip="Continuar"
                      tooltipPosition="left"
                      (click)="navigateContinueSteps(recopilation.id)"
                    />
                  } @else {
                    <p-button
                      severity="success"
                      icon="pi pi-eye"
                      rounded="true"
                      outlined="true"
                      pTooltip="Ver Detalles"
                      tooltipPosition="left"
                      (click)="navigateRecopilationDetails(recopilation.id)"
                    />
                  }
                  <p-button
                    severity="warning"
                    icon="pi pi-trash"
                    rounded="true"
                    outlined="true"
                    pTooltip="Eliminar"
                    tooltipPosition="left"
                    (click)="
                      confirmRecopilationDeletion(
                        $event,
                        recopilation.id,
                        recopilation.name
                      )
                    "
                  />
                </div>
              </section>
            </ng-template>
            <p class="m-0 pb-3" style="max-width: 80vw">
              {{ recopilation.description }}
            </p>
          </p-panel>
        }
      </p-panel>
    }
  </section>
  <p-scrollTop icon="pi pi-chevron-up" />
</main>
<p-confirmDialog />
